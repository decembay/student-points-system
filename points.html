<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Scan QR - Update Points</title>
    <link rel="stylesheet" href="points.css">
    <script src="script.js"></script>
  </head>
  <body>
    <div class="container">
      <h2>üéØ Update Student Points</h2>
      <div id="student-info"></div>
      <div class="btn-group">
        <input type="number" id="points-value" value="1" min="1" style="border-radius:8px; padding:8px; width:80px; font-size:1em;">
        <button onclick="updatePoints('add')">Add Points</button>
        <button onclick="updatePoints('subtract')">Subtract Points</button>
      </div>
      <p id="status"></p>
    </div>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const studentId = urlParams.get("id");

      function loadStudent() {
        google.script.run.withSuccessHandler(function(student){
          if(student){
            document.getElementById("student-info").innerHTML = 
              `<h3>${student.Name} (${student.Class})</h3><p>Points: ${student.Points}</p>`;
          } else {
            document.getElementById("student-info").innerHTML = "‚ùå Student not found.";
          }
        }).getStudentById(studentId);
      }

      function updatePoints(action){
        const value = parseInt(document.getElementById('points-value').value, 10) || 0;
        const change = action === 'add' ? value : -value;
        google.script.run.withSuccessHandler(function(newPoints){
          document.getElementById("status").innerText = "Updated! New Points: " + newPoints;
          loadStudent();
        }).updateStudentPoints(studentId, change);
      }

      loadStudent();
    </script>
  </body>
</html>
